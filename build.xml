<?xml version="1.0"?>

<project name="MidpSSH" basedir="." default="all">

	<taskdef resource="antenna.properties"/>
	<!--
	<property name="wtk.home" value="c:\WTK21"/>
	<property name="deviceName" value="DefaultColorPhone" />
	-->
	<property name="wtk.home" value="c:\SonyEricsson\J2ME_SDK\PC_Emulation\WTK2" />
	<property name="deviceName" value="SonyEricsson_K700" />

	<property name="wtk.midp.version" value="2.0"/>
	
	<property name="jad.file" value="midpssh.jad"/>
	<property name="jar.file" value="midpssh.jar"/>
	<property name="zip.file" value="midpssh.zip"/>
	<property name="name" value="MidpSSH"/>

    <target name="jad">
    	<!-- Create a JAD file. -->
    	        
        <wtkjad jadfile="${jad.file}"
                jarfile="${jar.file}"
                name="${name}"
                vendor="XK72"
                version="1.0.0">

            <midlet name="${name}" class="app.Main"/>

        </wtkjad>
    </target>

	<target name="clean">
		<delete dir="classes"/>
		<delete dir="output"/>
		<delete file="${jar.file}"/>
		<delete file="${zip.file}"/>
	</target>
    	
   	<target name="compile" depends="jad">
        <mkdir dir="classes"/>

        <!-- Compile everything, but don't preverify (yet). -->

        <wtkbuild srcdir="src"
                  destdir="classes"
                  preverify="false"/>

        <!-- Package everything. Most of the necessary information is
             contained in the JAD file. Also preverify the result this
             time. To obfuscate everything, set the corresponding
             parameter to "true" (requires RetroGuard or ProGuard). The
             version parameter increments the MIDlet-Version by one. -->
	</target>
   		
	<target name="package" depends="compile">
        <wtkpackage jarfile="${jar.file}"
                    jadfile="${jad.file}"
                    obfuscate="false"
                    preverify="false">

            <!-- Package our newly compiled classes. -->

            <fileset dir="classes"/>
        	<fileset dir="res"/>
        </wtkpackage>
    </target>
		
	<target name="obfuscate" depends="package">
    	<!-- Obfuscate -->
    	
    	<wtkobfuscate jarfile="${jar.file}"
        			  jadfile="${jad.file}"
    				  obfuscator="proguard"
    				  classpath="lib/proguard.jar">
    		<!--<argument value="-dontshrink" />-->
    		<argument value="-keep class ssh.Blowfish" />
    		<argument value="-keep class ssh.DES" />
    		<argument value="-keep class ssh.DES3" />
    		<argument value="-keep class ssh.IDEA" />
			<argument value="-keep class ssh.MD5" />
			<argument value="-keep class ssh.MPN" />
			<argument value="-keep class ssh.NONE" />
    		<argument value="-defaultpackage" />
    		<argument value="-verbose" />
		</wtkobfuscate>
    </target>
	
	<target name="obfuscatesmall" depends="package">
		<!-- Obfuscate -->
		    	
		    	<wtkobfuscate jarfile="${jar.file}"
		        			  jadfile="${jad.file}"
		    				  obfuscator="proguard"
		    				  classpath="lib/proguard.jar">
		    		<!--<argument value="-dontshrink" />-->
		    		<argument value="-keep class ssh.Blowfish" />
		    		<argument value="-defaultpackage" />
		    		<argument value="-verbose" />
				</wtkobfuscate>
	</target>
		
	<target name="preverify">
        <!-- Preverify. -->
        <wtkpreverify jarfile="${jar.file}"
                      jadfile="${jad.file}"/>
    </target>
	
	<target name="run" depends="package,preverify">
		<!-- Start the MIDlet suite -->

    	<wtkrun jadfile="${jad.file}" device="${deviceName}" wait="true"/>
	</target>
	<!--
	<target name="runother">
		<wtkrun jadfile="TelnetFloyd-1.1.jad" device="DefaultColorPhone" wait="true"/>
	</target>
	-->
	<target name="all" depends="clean,package,obfuscate,preverify">
	
	</target>
	
	<target name="small" depends="clean,package,obfuscatesmall,preverify">
	
	</target>
	
	<target name="runobfuscated" depends="package,obfuscate,preverify">
		<!-- Start the MIDlet suite -->

    	<wtkrun jadfile="${jad.file}" device="${deviceName}" wait="true"/>
	</target>

	<target name="deploy">
		<exec executable="C:\SonyEricsson\J2ME_SDK\OnDeviceDebug\bin\ejava">
			<arg value="install" />
			<arg value="${jad.file}" />
		</exec>
	</target>
	
	<target name="source">
		<zip zipfile="${zip.file}">
			<fileset dir=".">
				<include name="src/**"/>
				<include name="res/**"/>
				<include name="lib"/>
				<include name="*.txt"/>
				<include name="*.xml"/>
				<include name="${jad.file}"/>
				<include name="${jar.file}"/>
			</fileset>
		</zip>
	</target>
</project>
